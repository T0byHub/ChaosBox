<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Sand & Wasser Simulation</title>
  <style>
    body { margin: 0; background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; }
    canvas { border: 1px solid #888; image-rendering: pixelated; cursor: crosshair; }
    #tools { position: absolute; top: 10px; left: 10px; z-index: 10; }
    button { margin-right: 5px; padding: 6px; font-size: 14px; }
  </style>
</head>
<body>
<div id="tools">
  <button onclick="currentElement = 1">Sand</button>
  <button onclick="currentElement = 2">Wasser</button>
</div>
<canvas id="sandcanvas" width="300" height="300"></canvas>
<script>
  const canvas = document.getElementById('sandcanvas');
  const ctx = canvas.getContext('2d');
  const width = canvas.width;
  const height = canvas.height;
  const pixels = new Uint8Array(width * height);
  let currentElement = 1; // 1 = sand, 2 = wasser

  function index(x, y) {
    return y * width + x;
  }

  function update() {
    for (let y = height - 2; y >= 0; y--) {
      for (let x = 1; x < width - 1; x++) {
        const i = index(x, y);
        const below = index(x, y + 1);

        if (pixels[i] === 1) { // sand
          if (pixels[below] === 0 || pixels[below] === 2) {
            [pixels[i], pixels[below]] = [pixels[below], pixels[i]];
          }
        } else if (pixels[i] === 2) { // wasser
          const dirs = [index(x, y + 1), index(x - 1, y + 1), index(x + 1, y + 1), index(x - 1, y), index(x + 1, y)];
          for (const j of dirs) {
            if (pixels[j] === 0) {
              pixels[j] = 2;
              pixels[i] = 0;
              break;
            }
          }
        }
      }
    }
  }

  function draw() {
    const imgData = ctx.createImageData(width, height);
    for (let i = 0; i < pixels.length; i++) {
      let r = 0, g = 0, b = 0;
      if (pixels[i] === 1) { r = 194; g = 178; b = 128; } // sandfarbe
      if (pixels[i] === 2) { r = 64; g = 164; b = 223; } // wasserfarbe
      imgData.data[i * 4 + 0] = r;
      imgData.data[i * 4 + 1] = g;
      imgData.data[i * 4 + 2] = b;
      imgData.data[i * 4 + 3] = 255;
    }
    ctx.putImageData(imgData, 0, 0);
  }

  canvas.addEventListener('mousemove', e => {
    if (e.buttons === 1) {
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left) / rect.width * width);
      const y = Math.floor((e.clientY - rect.top) / rect.height * height);
      pixels[index(x, y)] = currentElement;
    }
  });

  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }

  loop();
</script>
</body>
</html>
